<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>How-to: Write a Twitter bot</title>
    <meta name="description" content="Yee-ello, there! Let’s take a quick (and possibly dirty) look at how to write your very ownTwitter bot in Python.">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://yourdomain.com/python/2015/08/26/howto-twitter-bot.html">
    <link rel="alternate" type="application/rss+xml" title="fyi." href="http://yourdomain.com/feed.xml" />


    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                    m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-52445936-14', 'auto');
        ga('send', 'pageview');

    </script>
</head>


    <body>

        <header class="site-header">

    <div class="wrapper">

        <div class="title-div">
            <a class="site-title" href="/">fyi.</a>
        </div>
    </div>

    <div class="wrapper">
        <nav class="site-nav">
            <a href="#" class="menu-icon">
                <svg viewBox="0 0 18 15">
                <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
                <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
                <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
                </svg>
            </a>

            <div class="trigger">
                
                <!-- Static 'Home' link -->
                <a class="page-link" href="/">Home</a>
                
                
                
                
                
                
                
                
            </div>
        </nav>

    </div>

</header>


        <div class="wrapper">
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <!-- fyi - page - under header -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-3632636155475507"
             data-ad-slot="5572041490"
             data-ad-format="auto"></ins>
        <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
        </script> 
        </div>

        <div class="page-content">
            <div class="wrapper">
                <div class="post">

    <header class="post-header">
        <div class="buy-coffee-post-header">
            <a href='http://ko-fi.com?i=9152LY80MBJF' target='_blank' class="coffee-link">
                <img style='border:0px' width="150px" src='https://az743702.vo.msecnd.net/cdn/btn1.png' border='0' alt='Buy Me A Coffee at Ko-Fi.com' class="coffee-img"/>
            </a> 
        </div>
        <h1 class="post-title">How-to: Write a Twitter bot</h1>
        <p class="post-meta">Aug 26, 2015</p>


    </header>

    <article class="post-content">
        <p>Yee-ello, there! Let’s take a quick (and possibly dirty) look at how to write your very own
Twitter bot in Python.</p>

<h2 id="but-why">But… why?</h2>

<hr />

<p>For countless reasons. You could write your own watcher bot for Twitter that
crawls stuff you’re interested of, or you could automate some routines like
posting to Twitter every time you publish a new YouTube video or write a blog
post. Maybe there’s a celebrity you want to bombard by retweeting or starring
every single one of their tweets.</p>

<h2 id="why-python">Why Python?</h2>

<hr />

<p>It’s just a really, <em>really</em> easy way of doing it. If you don’t fancy Python,
you can find just as simple Twitter libraries for almost any language there is.
Code snippets aside, the same steps are necessary to acquire the API access.</p>

<h2 id="okay-lets-do-it">Okay, let’s do it!</h2>

<hr />

<p>Great! First off, create a new virtual environment for the project. Once you’re
done, you need to install <a href="https://github.com/bear/python-twitter"><code class="highlighter-rouge">python-twitter</code></a>
library. You can do it with pip like this:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>pip install python-twitter
</code></pre>
</div>

<p>Oh, by the way, this library is open-source, licensed under Apache 2.0, so you
can do just about anything with it, including selling your ready-made bot.</p>

<p>Okay, now you’re ready to write your bot. So let’s not! Instead, either create
a new Twitter account for your bot to manage, or log in to your current one.
Be sure to set your phone number on your account, as the account needs to be
verified. You’ll receive a PIN code later on in the app creation process.</p>

<p>Next, head over to the <a href="https://apps.twitter.com/">Twitter Apps</a> and click “Create
a new app”.</p>

<p><img src="/assets/twitter-bot/step_1.png" alt="Create a new Twitter App" /></p>

<p>Next, fill out the “Name”, “Description” and “Website” fields. For now, if you
don’t have a web site, you can leave a placeholder. You can leave the callback
URL field empty. Finally, check the developer agreement and click “Create your
Twitter application”. Note that the name must be unique (Sorry, I already took
“Manabreak’s awesome bot”).</p>

<p><img src="/assets/twitter-bot/step_2.png" alt="Fill out the form" /></p>

<p>Now you should have your app created and see something like this:</p>

<p><img src="/assets/twitter-bot/step_3.png" alt="Application Settings" /></p>

<p>And if you scroll down, there should be this part called “Your Access Token”.
Go ahead and click the “Create my access token” button to, well, unsurprisingly
create your access token.</p>

<p><img src="/assets/twitter-bot/step_4.png" alt="Access Token" /></p>

<p>Finally! We are done with the app management thingy! You should see your newly
created access token here. The four things you will need from this page are:</p>

<ul>
  <li>
    <p>The consumer key (API Key)</p>
  </li>
  <li>
    <p>The consumer secret (API Secret)</p>
  </li>
  <li>
    <p>The access token</p>
  </li>
  <li>
    <p>The access token secret</p>
  </li>
</ul>

<p>Either leave the page open or copy-paste these four things as you will need them
to write your bot.</p>

<h2 id="coding-we-shall-do-mm">Coding we shall do, mm?</h2>

<hr />

<p>Okay, enough with the awful browser-based setups. Let’s whip out our beloved Python!
First off, import the Twitter library:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">twitter</span></code></pre></figure>

<p>Not so difficult, is it? Next, remember how we just saw the four keys-slash-secrets?
Now is the time we need them. Write the following piece of code:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">api</span> <span class="o">=</span> <span class="n">twitter</span><span class="o">.</span><span class="n">Api</span><span class="p">(</span><span class="n">consumer_key</span> <span class="o">=</span> <span class="s">'CONSUMER KEY HERE'</span><span class="p">,</span>
                  <span class="n">consumer_secret</span> <span class="o">=</span> <span class="s">'CONSUMER SECRET HERE'</span><span class="p">,</span>
                  <span class="n">access_token_key</span> <span class="o">=</span> <span class="s">'ACCESS TOKEN HERE'</span><span class="p">,</span>
                  <span class="n">access_token_secret</span> <span class="o">=</span> <span class="s">'ACCESS TOKEN SECRET HERE'</span><span class="p">)</span></code></pre></figure>

<p>Err, actually, don’t write literally just that. Instead, replace the portions
between the quotes with your actual keys and secrets. Also, what did we just do?
We initialized the Twitter library. To make sure you got the keys and secrets
right, we can verify the credentials:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">if</span> <span class="n">api</span><span class="o">.</span><span class="n">VerifyCredentials</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Credentials ok! You may start your shindigs!'</span><span class="p">)</span></code></pre></figure>

<p>If the credentials were indeed OK, we can go and troll the hell out of Twitter.
Now is as good time as any to think about <em>what</em> you want to do with your bot.
In the meantime, I’ll show you something neat.</p>

<h3 id="fetch-the-currently-trending-topics">Fetch the currently trending topics</h3>

<p>You know the little “Trending” column on Twitter? There’s ten trending hashtags
or topics there. If you want to fetch those topics, here’s what you do:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get the Top 10 trending things</span>
<span class="n">trends</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetTrendsCurrent</span><span class="p">()</span>

<span class="k">for</span> <span class="n">trend</span> <span class="ow">in</span> <span class="n">trends</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"Currently trending: </span><span class="si">%</span><span class="s">s"</span> <span class="o">%</span> <span class="p">(</span><span class="n">trend</span><span class="o">.</span><span class="n">name</span><span class="p">))</span></code></pre></figure>

<p>Well! That wasn’t so difficult. Actually, the Twitter library we’re using is
simple as heck. Let’s see some other examples.</p>

<h3 id="automatically-mark-posts-as-favorite-when-someone-mentions-you">Automatically mark posts as favorite when someone mentions you</h3>

<p>Suppose you are overly confident of your virtual presence in the somesphere and
you are absolutely certain all mentions about you are always positive. In that
case, you could automate the process of starring the posts with this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get the 20 latest mentions of you</span>
<span class="n">mentions</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetMentions</span><span class="p">()</span>
<span class="k">for</span> <span class="n">mention</span> <span class="ow">in</span> <span class="n">mentions</span><span class="p">:</span>
    <span class="n">api</span><span class="o">.</span><span class="n">CreateFavorite</span><span class="p">(</span><span class="n">mention</span><span class="p">)</span></code></pre></figure>

<p>Enjoy your ever-growing list of favorite posts! Now only if someone would
mention me…</p>

<h3 id="re-tweet-posts-that-are-not-yet-retweeted-by-other-users">Re-tweet posts that are not yet retweeted by other users</h3>

<p>I have no idea why you would like to do this other than to boost some poor
soul’s self-confidence. In any case, let’s say you’d like to go through the
latest curling-related posts and re-tweet them if they haven’t re-tweeted yet.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Search for curling-related posts</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetSearch</span><span class="p">(</span><span class="n">term</span> <span class="o">=</span> <span class="s">'curling'</span><span class="p">,</span> <span class="n">result_type</span> <span class="o">=</span> <span class="s">'recent'</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">post</span><span class="o">.</span><span class="n">retweet_count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">PostRetweet</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span></code></pre></figure>

<p>Really shows the power of the API, huh? In just four lines, we searched for curling-
themed tweets and retweeted if they didn’t have any retweets yet. Nice! Now all
those lonely curling tweeters can enjoy at least a single retweet! Go Canada!</p>

<h3 id="follow-another-poor-soul-if-they-dont-have-any-followers">Follow another poor soul if they don’t have any followers</h3>

<p>Continuing with the poor curling player theme, let’s see if any of those bastards
are all alone in Twitter. If they are, let’s give them a pity-follow:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Search for curling-related posts (just like last time)</span>
<span class="n">search_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetSearch</span><span class="p">(</span><span class="n">term</span> <span class="o">=</span> <span class="s">'curling'</span><span class="p">,</span> <span class="n">result_type</span> <span class="o">=</span> <span class="s">'recent'</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">post</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">followers_count</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">api</span><span class="o">.</span><span class="n">CreateFriendship</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">follow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span></code></pre></figure>

<p>Neato burrito. One thing that boggles me, though: Twitter uses “follow” and “friendship”
pretty much interchangeably, and I have never understood the difference between the two.
Well, this piece of code does the trick. No more lonely curling enthusiasts on Twitter,
and we are yet another step closer to world peace.</p>

<h3 id="bonus-round-get-your-bots-write-permissions-revoked-by-this-one-neat-little-trick">BONUS ROUND: Get your bot’s write permissions revoked by this one neat little trick!</h3>

<p>So, you’re already fed up with your bot being all nice to canadians? You’d like
it to stop doing things, but are too lazy to just… turn off the bot? Well then,
you’re in luck! If you go absolutely bonkers with your bot, I can guarantee it will
get its write permissions revoked in no time!</p>

<p>For starters, you can loop through the newest trends forever, retweeting every
single tweet you find and, as a bonus, follow the users who tweeted them. Ah,
what the hell, let’s star the posts too! You can never have too many favorites!</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Search for curling-related posts</span>
<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="n">trends</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetTrendsCurrent</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">trend</span> <span class="ow">in</span> <span class="n">trends</span><span class="p">:</span>
        <span class="n">search_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetSearch</span><span class="p">(</span><span class="n">term</span> <span class="o">=</span> <span class="n">trend</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">search_results</span><span class="p">:</span>
            <span class="n">api</span><span class="o">.</span><span class="n">PostRetweet</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">api</span><span class="o">.</span><span class="n">CreateFriendship</span><span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">follow</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
            <span class="n">api</span><span class="o">.</span><span class="n">CreateFavorite</span><span class="p">(</span><span class="n">post</span><span class="p">)</span></code></pre></figure>

<p>There we go! Now the bot will fetch the current trends, search for posts using
each of the trend and retweet and favorite all those posts and follow the users.
When all the trends are handled, it all starts from the beginning, fetching new
trends (if they’ve changed) and doing it all over again.</p>

<p>Oh, one more thing: don’t do this.</p>

<h3 id="throw-in-some-fault-tolerance">Throw in some fault tolerance</h3>

<p>When you write a bot, chances are you don’t want to be looking after it all day
long in case it catches on fire or goes berserk over neighborhood kids. Instead,
I bet you want relax, slowly sip through your cappuccino while browsing
<a href="http://www.reddit.com/r/funny">/r/funny</a> and be sure that your bot is doing
all the things you told it to without crashing.</p>

<p>First off, let’s suppose you’d like the bot to tell you what it’s retweeting.
You’d do something like this:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># Get some posts somehow</span>
<span class="n">posts</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">for</span> <span class="n">post</span> <span class="ow">in</span> <span class="n">posts</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Handling post: </span><span class="si">%</span><span class="s">s'</span> <span class="o">%</span> <span class="p">(</span><span class="n">post</span><span class="o">.</span><span class="n">text</span><span class="p">))</span></code></pre></figure>

<p>This is fine so far, but Python might flip its shit if the tweet is written in,
say, mandarin chinese. This would cause the <code class="highlighter-rouge">print</code> command to fail. In order
to prevent this, let’s use a codec for <code class="highlighter-rouge">stdout</code>. To the beginning of your code,
add this code:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">twitter</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getwriter</span><span class="p">(</span><span class="s">"iso-8859-1"</span><span class="p">)(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span> <span class="s">"xmlcharrefreplace"</span><span class="p">)</span></code></pre></figure>

<p>Great! Now the program shouldn’t crash for character encoding reasons. Another
problem may arise if the API doesn’t behave correctly. This may be if you do
a wonky API call or if Twitter responds with something unsuspected. To ensure
your bot won’t crash, you should surround your API calls with try-except:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">try</span><span class="p">:</span>
    <span class="n">search_results</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">GetSearch</span><span class="p">(</span><span class="n">term</span> <span class="o">=</span> <span class="s">'#cobacabana'</span><span class="p">)</span>
<span class="k">except</span> <span class="n">twitter</span><span class="o">.</span><span class="n">TwitterError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c"># Handle the exception, or just 'pass' if you don't want to</span>
    <span class="k">pass</span></code></pre></figure>

<p>That’s it!</p>

<h2 id="conclusion">Conclusion</h2>

<hr />

<p>Writing a Twitter bot with Python is a piece of cake, and the available API is
absolutely brilliant and fool-proof in its simplicity. Now if we only had something
meaninful for a bot to do… Until then, why don’t you fiddle around with your
bot?</p>

<p>If you found this post useful, you can support my caffeine-induced journey by
<a href="http://ko-fi.com?i=9152LY80MBJF">buying me a cup of coffee</a>!</p>

<hr />

    </article>

    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <!-- fyi - post - bottom -->
    <ins class="adsbygoogle"
         style="display:block"
         data-ad-client="ca-pub-3632636155475507"
         data-ad-slot="5770517898"
         data-ad-format="auto"></ins>
    <script>
    (adsbygoogle = window.adsbygoogle || []).push({});
    </script>

</div>

            </div>
        </div>

        <div class="wrapper">
    <footer class="site-footer">

        <div class="coffee-wrapper">
            <a href='http://ko-fi.com?i=9152LY80MBJF' target='_blank' class="coffee-link">
                <img style='border:0px' width="150px" src='https://az743702.vo.msecnd.net/cdn/btn1.png' border='0' alt='Buy Me A Coffee at Ko-Fi.com' class="coffee-img"/>
            </a> 
        </div>
        
        
        <div class="some-wrapper">
            <a href="https://twitter.com/dManabreak">
                <span class="icon  icon--twitter">
                    <svg viewBox="0 0 16 16">
                    <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809
                          c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/>
                    </svg>
                </span>

                <span class="username">dManabreak</span>
            </a>
        </div>
        

        <p class="rss-subscribe">subscribe <a href="/feed.xml">via RSS</a></p>

        

    </footer>
</div>


    </body>

</html>
